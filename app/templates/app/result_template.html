{% extends "app/layout.html" %}

{% block content %}
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/series-label.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>



<div class="jumbotron">
    <h1>Wyniki wyszukiwania {{ name }}</h1>

</div>
<p><a class="btn btn-default" href="refresh">Odśwież dane &raquo;</a> 
  <button class="btn btn-default" onclick="ShowAndHide()">Pokaż dane historyczne dla tego modelu &raquo;</button>
</p>
<div class="row">
    {% if item_list|length > 0 %}
    <table class="table">
        <thead>
            <tr>
                <th scope="col">Nazwa modelu:</th>
                <th scope="col">Cena:</th>
                <th scope="col">Link:</th>
            </tr>
        </thead>
        <tbody>
    {% endif %}
            {% if item_list|length > 0 %}
            {% for listItem in item_list %}
            <tr>
                <td>{{ listItem.card }}</td>
                <td>{{ listItem.price}}</td>
                <td><a href="{{listItem.link}}" targer="_blank">{{listItem.link}}</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <h2>Niestety, ta karta nie jest dostępna... Spróbuj ponownie później</h2>
    {% endif %}

    <h3> Średnia cena z dzisiaj: {{ average }} </h3>
    <br/>



</div>

{% if history_list|length > 1 %}
<div id="history_table">
  <h3> Średnia cena historyczna: {{ average_history }} </h3>
<div id="container"></div>
{% endif %}


{% if history_list|length > 0 %}

<table class="table">
    <thead>
        <tr>
            <th scope="col">Data</th>
            <th scope="col">Średnia cena</th>
        </tr>
    </thead>
    <tbody>
{% endif %}
        {% if history_list|length > 0 %}
        {% for listItem in history_list %}
        <tr>
            <td>{{ listItem.date }}</td>
            <td>{{ listItem.price}}</td>
        
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<h2>Niestety, dane historyczne nie są dostępne dla tej karty... Spróbuj ponownie później</h2>
</div>
{% endif %}
</div>


<script type="text/javascript">
var card_price = [
  {% for item in history_list %}
  {
  'price': {{ item.price }},
  'date': '{{item.date}}'
},
 {% endfor %}
 ]
  
  card_price = card_price.map(function(e) {
    return {
      'y': e.price,
      'x': new Date(e.date).getTime()
    }
  })
  
  Highcharts.chart('container', {
    title: {
      text: 'Średnia cena'
    },
    xAxis: {
      type: 'datetime',
      dateTimeLabelFormats: {
        day: '%e of %b'
      }
    },
    series: [{
      data: card_price
    }]
  });</script>

  <script>
    function ShowAndHide() {
  var x = document.getElementById("history_table");
  if (x.style.display === "block") {
    x.style.display = "none";
  } else {
    x.style.display = "block";
  }
}
  </script>
        {% endblock %}
