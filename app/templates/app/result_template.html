{% extends "app/layout.html" %}

{% block content %}
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/series-label.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>



<div class="jumbotron">
    <h1>Wyniki wyszukiwania {{ name }}</h1>

</div>
<p><a class="btn btn-default" href="refresh">Odśwież dane &raquo;</a></p>
<div class="row">
    {% if item_list|length > 0 %}
    <table class="table">
        <thead>
            <tr>
                <th scope="col">Nazwa modelu:</th>
                <th scope="col">Cena:</th>
                <th scope="col">Link:</th>
            </tr>
        </thead>
        <tbody>
    {% endif %}
            {% if item_list|length > 0 %}
            {% for listItem in item_list %}
            <tr>
                <td>{{ listItem.card }}</td>
                <td>{{ listItem.price}}</td>
                <td><a href="{{listItem.link}}" targer="_blank">{{listItem.link}}</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <h2>Niestety, ta karta nie jest dostępna... Spróbuj ponownie później</h2>
    {% endif %}

    <h3> Średnia cena z dzisiaj: {{ average }} </h3>
    <br/>

    {% if history_list|length > 0 %}
    <table class="table">
        <thead>
            <tr>
                <th scope="col">Data</th>
                <th scope="col">Średnia cena</th>
            </tr>
        </thead>
        <tbody>
    {% endif %}
            {% if history_list|length > 0 %}
            {% for listItem in history_list %}
            <tr>
                <td>{{ listItem.date }}</td>
                <td>{{ listItem.price}}</td>
            
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <h2>Niestety, ta karta nie jest dostępna... Spróbuj ponownie później</h2>
    {% endif %}

</div>
<div id="container"></div>
<script type="text/javascript">
    var one_yr = "{{ history_variable }}"
  
  one_yr = one_yr.map(function(e) {
    return {
      'y': e.price,
      'x': new Date(e.date).getTime()
    }
  })
  
  Highcharts.chart('container', {
    title: {
      text: 'AVG price'
    },
    xAxis: {
      type: 'datetime',
      dateTimeLabelFormats: {
        day: '%e of %b'
      }
    },
    series: [{
      data: one_yr
    }]
  });</script>
        {% endblock %}
